# oauth2-proxy-ingress

![Version: 1.1.0](https://img.shields.io/badge/Version-1.1.0-informational?style=flat-square)

helm chart to create multiple ingresses to use with a single oauth2-proxy

## Configuring dex and oauth2-proxy

create a static client with multiple redirectURIs with the [dex helm chart](https://artifacthub.io/packages/helm/dex/dex)
```
config:
  staticClients:
    - id: oauth2-proxy
      redirectURIs:
        - 'https://subdomain1.example.com/oauth2/callback'
        - 'https://subdomain1.example.com/oauth2/callback'
      name: 'Login for everything'
      secret: XXXXXXXXXXXXXXXXX
```

then use rewriting in mutliple upstreams with the [oauth2-proxy helm chart](https://artifacthub.io/packages/helm/oauth2-proxy/oauth2-proxy)
```
ingress:
  enabled: false
config:
  configFile: {}
alphaConfig:
  enabled: true
  configData:
    providers:
      - provider: oidc
        id: dex
        clientID: oauth2-proxy
        clientSecret: XXXXXXXXXXXXXXXXX
        scope: openid email profile
        oidcConfig:
            userIDClaim: email
            emailClaim: email
            issuerURL: https://dex.example.com
            audienceClaims:
            - aud
            - email
    upstreamConfig:
        upstreams:
        - id: subdomain1
            path: '^/subdomain1/(.*)'
            rewriteTarget: '/$1'
            uri: http://service1.namespace1
        - id: subdomain2
            path: '^/subdomain2/(.*)'
            rewriteTarget: '/$1'
            uri: http://service2.namespace2

```

## update docs

```
docker run --rm -v $(pwd):/app -w/app jnorwood/helm-docs -t helm-docs-template.gotmpl
```

## additional links

* [Chart on Artifact HUB](https://artifacthub.io/packages/helm/itsmethemojo/oauth2-proxy-ingress)
* [Dex Chart on Artifact HUB](https://artifacthub.io/packages/helm/dex/dex)
* [Oauth2-Proxy Chart on Artifact HUB](https://artifacthub.io/packages/helm/oauth2-proxy/oauth2-proxy)

## Source Code

* <https://github.com/itsmethemojo/helm-oauth2-proxy-ingress>

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| annotations | object | `{}` | additional ingress annotations |
| autoCreateTls | bool | `true` | this will create a default tls block for the ingress |
| domainBase | string | `"example.com"` | domain base all the subdomains share |
| externalDnsEnabled | bool | `false` | this will add the external-dns.alpha.kubernetes.io/hostname annotation |
| fullnameOverride | string | `""` |  |
| ingressClassName | string | `"nginx"` |  |
| nameOverride | string | `""` |  |
| oauth2proxy.service.name | string | `"oauth2-proxy"` | service name of the installed oauth2-proxy. ingress must be installed in the same namespace |
| oauth2proxy.service.port | int | `80` | port of the installed oauth2-proxy |
| subdomains | list | `["subdomain1","subdomain2"]` | list of subdomains that will be hidden behind the oauth2-proxy |
| tls | object | `{}` | if needed a custom tls block for every subdomain can bet set here, see values.yaml |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.11.0](https://github.com/norwoodj/helm-docs/releases/v1.11.0)
